# uv-101 – менеджер окружений и зависимостей курса

## 1. Зачем нам uv

`uv` – это быстрый менеджер пакетов и проектов для Python, который мы используем на курсе как **единый способ**:

- устанавливать зависимости проекта;
- создавать и поддерживать виртуальное окружение;
- запускать скрипты, ноутбуки и сервисы с нужной версией Python;
- фиксировать состав окружения в `pyproject.toml`.

Идея простая:

> Вместо того чтобы руками создавать `venv`, ставить `pip install ...` и гадать, в каком окружении ты сейчас, мы используем одну утилиту – `uv`.

## 2. Что нужно уметь до uv

Перед тем как использовать `uv`, предполагается, что ты:

- читаешь и вводишь команды в терминале (см. `unix-101.md`);
- понимаешь, что такое проект на Python и как он запускается (см. `python-101.md`);
- умеешь клонировать репозиторий курса и пушить изменения (см. `git-101.md`).

`uv` не заменяет эти навыки, а просто делает работу с Python-проектами удобнее и единообразнее.

## 3. Установка и проверка

Инструкции по установке `uv` зависят от ОС (Windows/macOS/Linux), поэтому:

- используй **официальную документацию** `uv` или инструкции из методички курса;
- после установки в терминале должны работать команды:

```bash
uv --version
uv help
```

Если команды не находятся, значит `uv` либо не установлен, либо не добавлен в `PATH`.

На всём курсе дальше предполагается, что:

- `uv` уже установлен;
- команда `uv` доступна из терминала.

## 4. Общая модель работы с uv

Ключевые идеи:

- **Проект** описывается файлом `pyproject.toml` в корне репозитория.
- `uv` сам создаёт и обслуживает виртуальное окружение (обычно в `.venv`).
- Ты **не создаёшь вручную** `venv` и **не делаешь** `pip install` напрямую для курсового репозитория.
- Все запуски делаются через `uv run ...`, чтобы гарантировать правильное окружение.

В типичном репозитории курса (шаблон студента, репозиторий проекта и т.п.) `pyproject.toml` уже есть – тебе остаётся только синхронизировать зависимости и пользоваться.

## 5. Первый запуск в новом репозитории

### 5.1. Клонирование и установка зависимостей

1. Клонируешь репозиторий (пример):

    ```bash
    git clone <URL_репозитория>
    cd <имя_папки_репозитория>
    ```

2. Один раз создаёшь окружение и ставишь зависимости:

    ```bash
    uv sync
    ```

Что делает `uv sync`:

- создаёт виртуальное окружение, если его ещё нет;
- устанавливает зависимости из `pyproject.toml`;
- подготавливает всё к дальнейшему `uv run ...`.

После успешного `uv sync` репозиторий готов к работе: можно запускать ноутбуки, скрипты, тесты, сервисы и т.д.

### 5.2. Репозиторий без pyproject.toml (для своих мини-проектов)

Если у тебя есть отдельный личный мини-проект вне курса и в папке нет `pyproject.toml`, можно инициализировать проект под управлением `uv`:

```bash
uv init
```

После этого в папке появится `pyproject.toml`, а дальше всё работает по тем же правилам:

```bash
uv sync
uv run python main.py
```

Для **курсового** репозитория обычно это не нужно – там `pyproject.toml` уже есть.

## 6. Запуск кода через uv

Главное правило:

> Всё, что относится к проекту курса, запускается через `uv run`, а не напрямую через `python` или `jupyter`.

### 6.1. Запуск скрипта Python

Пример: запустить скрипт домашки:

```bash
uv run python homeworks/HW01/main.py
```

Пример: запустить утилиту в `project/`:

```bash
uv run python -m project.cli --help
```

### 6.2. Запуск Jupyter

Если в репозитории предусмотрена работа с ноутбуками:

```bash
uv run jupyter lab
# или
uv run jupyter notebook
```

Так ты гарантируешь, что ноутбуки запускаются в том же окружении, где установлены зависимости проекта.

### 6.3. Запуск тестов и утилит

Примеры типовых команд:

```bash
# Запуск тестов (если в проекте есть pytest)
uv run pytest

# Запуск линтера/форматтера (ruff, black и т.п.)
uv run ruff check .
# или
uv run black .
```

### 6.4. Запуск сервиса на FastAPI

Если в проекте есть HTTP-сервис на FastAPI, типовой запуск через `uvicorn`:

```bash
uv run uvicorn app.main:app --reload --port 8000
```

Здесь `app.main:app` – это модуль и объект `FastAPI()` внутри него; конкретное имя может отличаться в зависимости от структуры проекта.

## 7. Управление зависимостями: uv add / uv remove

Все зависимости проекта описываются в `pyproject.toml` и управляются через `uv`.

### 7.1. Добавление зависимостей

Пример: добавить `pandas` и `matplotlib`:

```bash
uv add pandas matplotlib
```

`uv`:

- запишет зависимости в `pyproject.toml`;
- установит их в виртуальное окружение.

После этого можно уже делать:

```bash
uv run python your_script.py
```

> Для домашних заданий обычно **не требуется** добавлять новые библиотеки – нужные зависимости заранее прописаны. Для проекта добавление новых пакетов стоит согласовывать с требованиями курса.

### 7.2. Удаление зависимостей

Пример: удалить `seaborn` из зависимостей:

```bash
uv remove seaborn
uv sync
```

После `uv remove` и последующего `uv sync` пакет будет убран из `pyproject.toml` и из окружения.

## 8. Виртуальное окружение и версии Python

### 8.1. Где живёт окружение

По умолчанию `uv` создаёт виртуальное окружение в `.venv` внутри проекта (или в другом месте, в зависимости от настройки). Важно:

- обычно **не нужно** заходить в `.venv` руками;
- достаточно использовать `uv run ...`.

### 8.2. Если окружение «сломалось»

Если что-то пошло совсем не так (странные ошибки с пакетами, конфликт версий и т.п.):

```bash
# из корня репозитория
rm -rf .venv      # или удалить папку .venv вручную в проводнике
uv sync           # пересоздать окружение и переустановить пакеты
```

### 8.3. Версии Python

`uv` умеет управлять версиями Python и/или использовать уже установленный системный Python. На курсе принято:

- **не настраивать** вручную сложные схемы версий;
- довериться настройкам, которые заданы в `pyproject.toml` и окружении преподавателя.

Если тебе нужно более тонкое управление версиями Python для личных задач, смотри официальную документацию `uv`.

## 9. Типичные проблемы и как их диагностировать

### 9.1. `uv: command not found` или аналогичное сообщение

Возможные причины:

- `uv` не установлен;
- `uv` установлен, но не добавлен в `PATH`.

Что делать:

- проверить, установлен ли `uv` по инструкции из методички/официального сайта;
- перезапустить терминал/IDE после установки;
- убедиться, что используешь тот терминал/интерпретатор, в котором настраивался `PATH`.

### 9.2. `ModuleNotFoundError: No module named ...`

Частые причины:

- не выполнен `uv sync` в репозитории;
- скрипт запускается **без** `uv run` (через «просто `python`»).

Что делать:

1. В корне репозитория:

    ```bash
    uv sync
    ```

2. Запускать скрипты и ноутбуки **через** `uv run ...`.

### 9.3. «Всё работает у преподавателя, но не у меня»

Чек-лист:

1. Ты точно находишься в **корне правильного репозитория**?
2. Ты делал `uv sync` после клонирования/обновления репо?
3. Ты запускаешь код через `uv run`, а не через системный `python`?
4. У тебя нет «самодельного» `venv` внутри репозитория, созданного руками?

Если что-то из этого не выполняется – сначала исправь это, а уже потом ищи более тонкие проблемы.

## 10. Мини-чек-лист перед сдачей ДЗ/проекта

- Репозиторий собран и запускается на чистой машине по схеме:

  ```bash
  git clone ...
  cd ...
  uv sync
  uv run <команда запуска>
  ```

- Не используются глобальные `pip install` вне `uv`.

- Все зависимости описаны в `pyproject.toml` и ставятся через `uv sync`.

- Запуск ноутбуков/CLI/сервиса/тестов происходит через `uv run ...`.

Если это выполняется, то по части окружения и зависимостей у проекта всё хорошо.

---
