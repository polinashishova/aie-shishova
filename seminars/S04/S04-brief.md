# Семинар 04 - HTTP-сервис качества датасетов: FastAPI и API поверх eda-cli

## 1. Место в курсе

Четвёртый семинар курса «Инженерия Искусственного Интеллекта».

Непосредственно опирается на результаты Семинара S03 и домашнего задания HW03 по проекту `eda-cli`: к уже существующему EDA-ядру и CLI-интерфейсу добавляется **HTTP-слой** на FastAPI.

На этом шаге студенты переходят от «утилиты командной строки» к **микросервисному способу использования кода**:

- видят, как уже написанная логика (EDA, эвристики качества) оборачивается в HTTP-сервис;
- знакомятся с простым REST-контрактом для «модели предсказаний» (в нашем случае – качества датасета);
- учатся запускать сервис локально и проверять его через `/docs`, `curl` или HTTP-клиент.

Домашнее задание по семинару - **HW04**, его формальное описание дано в файле `seminars/S04/S04-homework.md`.  
HW04 выполняется в папке `homeworks/HW04/` личного репозитория студента.

---

## 2. Цели семинара

После семинара и выполнения домашнего задания студент:

- понимает базовую архитектуру HTTP-сервиса на FastAPI:
  - объект приложения `FastAPI`;
  - эндпоинты как функции-обработчики;
  - pydantic-модели как формальное описание запросов и ответов;
- умеет проектировать **простой REST-контракт** для «сервиса предсказаний»:
  - определять поля запросов и ответов;
  - выбирать и использовать базовые коды ошибок (`200`, `400`, `422`, `500`);
  - включать в ответ технические поля для логирования (latency, флаги качества и т.п.);
- может реализовать минимальный HTTP-сервис поверх своего `eda-cli`:
  - эндпоинт `/health` для проверки доступности сервиса;
  - эндпоинт `/quality` с JSON-запросом и эвристическим «предсказанием» качества;
  - эндпоинт `/quality-from-csv`, который использует функции `summarize_dataset`, `missing_table`, `compute_quality_flags` из ядра проекта;
- умеет запускать сервис локально:

  - через `uv run uvicorn eda_cli.api:app --reload --port 8000`;
  - проверять его работу через Swagger UI (`/docs`) и простые HTTP-запросы;

- понимает, как добавить **свой** дополнительный эндпоинт, завязанный на доработки HW03 (новые эвристики качества, JSON-сводки, дополнительные команды CLI).

---

## 3. Краткое содержание

1. **Вступление и связь с S01-S03**
   - напоминание, что на S03 проект `eda-cli` оформлялся как инженерный пакет с CLI-интерфейсом;
   - постановка задачи S04: научиться использовать тот же код как HTTP-сервис, доступный по REST.

2. **Мини-ввод в FastAPI и uvicorn**
   - краткий обзор подхода «Python-код как сервис»: FastAPI + Uvicorn;
   - структура `pyproject.toml` с зависимостями `fastapi` и `uvicorn[standard]`;
   - объект `FastAPI`, pydantic-модели, аннотации типов как часть контракта.

3. **Создание модуля `api.py` и эндпоинта `/health`**
   - добавление файла `src/eda_cli/api.py` в существующий проект;
   - определение `app = FastAPI(...)`, настройка заголовка и описания;
   - реализация `GET /health` с простым JSON-ответом (status/service/version);
   - обсуждение роли health-check для мониторинга и оркестраторов.

4. **Эндпоинт `/quality`: контракт по агрегированным признакам**
   - проектирование pydantic-моделей `QualityRequest` и `QualityResponse`:
     - обязательные поля запроса (`n_rows`, `n_cols`, `max_missing_share`, `numeric_cols`, `categorical_cols`);
     - обязательные поля ответа (`ok_for_model`, `quality_score`, `message`, `latency_ms`, `flags`, `dataset_shape`);
   - реализация простой «модели» (эвристики) для расчёта `quality_score`;
   - работа с кодами ошибок (`200` vs `400`/`422`), базовая обработка невалидного ввода;
   - измерение времени обработки (`perf_counter`) и включение `latency_ms` в ответ;
   - обсуждение того, какие поля ответа важно логировать для последующего анализа.

5. **Эндпоинт `/quality-from-csv`: связка с EDA-ядром S03**
   - приём CSV-файла через `UploadFile` (multipart/form-data);
   - чтение файла в `pandas.DataFrame` с обработкой ошибок;
   - использование EDA-функций из `eda_cli.core`:
     - `summarize_dataset(df)`;
     - `missing_table(df)`;
     - `compute_quality_flags(summary, missing_df)`;
   - формирование `QualityResponse` на основе `quality_score` и булевых флагов качества;
   - связь с тем, что уже делалось в CLI (`report` и эвристики из HW03).

6. **Идеи дополнительных пользовательских эндпоинтов (мост к HW04)**
   - обсуждение, как можно вынести в HTTP-интерфейс расширения из HW03:
     - эндпоинт `POST /quality-flags-from-csv` с полным набором флагов качества;
     - HTTP-версия JSON-сводки (если реализована в HW03);
     - HTTP-head/sample по CSV (если реализована CLI-команда в HW03);
   - разбор одного-двух примеров в live-coding режиме;
   - акцент на том, что в HW04 каждый студент должен реализовать **свой** дополнительный эндпоинт, связанный с его доработками `eda-cli`.

7. **Демонстрация запуска и тестирования сервиса**
   - запуск сервера:

     ```bash
     uv run uvicorn eda_cli.api:app --reload --port 8000
     ```

   - проверка `GET /health` в браузере и через `curl`;
   - использование Swagger UI (`/docs`) для отправки запросов на `/quality` и `/quality-from-csv`;
   - обсуждение статуса ответа, времени обработки и структуры JSON.

8. **Постановка домашнего задания HW04**
   - пояснение, что HW04 выполняется в папке `homeworks/HW04/` личного репозитория;
   - указание, что нужно:
     - перенести (или скопировать) проект `eda-cli` из HW03;
     - добавить HTTP-сервис (на основе кода семинара);
     - реализовать как минимум один новый эндпоинт, использующий доработки HW03;
   - обзор критериев зачёта HW04 на уровне:
     - сервис поднимается через `uv run uvicorn ...`;
     - `/health`, `/quality`, `/quality-from-csv` работают корректно;
     - новый эндпоинт реализован и действительно опирается на расширенное ядро `eda-cli`.

---

## 4. Формат проведения

Семинар проводится в формате, согласованном с общей политикой по семинарам:

- **Краткий разбор и напоминание контекста:**
  - связь S03 → S04;
  - зачем оборачивать EDA-ядро в сервис и какие задачи это решает.

- **Практическая часть (live-coding + демонстрация проекта):**
  - добавление зависимостей FastAPI/Uvicorn в `pyproject.toml` и `uv sync`;
  - создание и разбор модуля `api.py`;
  - реализация и запуск эндпоинтов `/health`, `/quality`, `/quality-from-csv`;
  - демонстрация работы сервиса через `/docs` и `curl`/HTTP-клиент;
  - пример расширения сервиса собственным эндпоинтом, связанным с HW03.

- **Постановка домашнего задания HW04:**
  - обсуждение ожидаемой структуры `homeworks/HW04/` в студенческом репозитории;
  - пояснение требований к собственному дополнительному эндпоинту;
  - ответы на вопросы по FastAPI, структуре `api.py`, запуску Uvicorn и проверке сервиса.

---

## 5. Результат для студента

К концу семинара студент:

- представляет себе путь от «библиотеки + CLI» к «HTTP-сервису» на примере `eda-cli`;
- умеет:
  - добавить в существующий Python-проект зависимости FastAPI/Uvicorn;
  - создать модуль `api.py` и настроить базовое приложение FastAPI;
  - реализовать и проверить эндпоинты `/health`, `/quality`, `/quality-from-csv`;
  - протестировать сервис через браузер (`/docs`) и простые HTTP-запросы.

После выполнения домашнего задания HW04 у студента:

- в репозитории есть папка `homeworks/HW04/` с проектом `eda-cli`, использующим FastAPI;
- реализован HTTP-сервис качества датасетов с базовыми эндпоинтами `/health`, `/quality`, `/quality-from-csv`;
- добавлен как минимум один собственный эндпоинт, который использует доработки ядра `eda-cli` из HW03;
- проект успешно поднимается и проверяется в стандартном окружении курса через `uv run uvicorn eda_cli.api:app …`.
